<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ü§ñ Chatbot v·ªÅ v·∫•n ƒë·ªÅ ph·∫ßn m·ªÅm thi</title>
  <style>
    :root {
      --radius: 14px;
    }

    body {
      font-family: system-ui, Arial, sans-serif;
      margin: 0;
      background: #f7f7fb;
      color: #222;
    }

    .container {
      max-width: 780px;
      margin: 36px auto;
      background: #fff;
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: 0 8px 28px rgba(0, 0, 0, .06);
    }

    h1 {
      margin: 0 0 8px;
      font-size: 22px;
    }

    p.meta {
      margin: 0 0 16px;
      color: #666;
      font-size: 14px;
    }

    #chatbox {
      border: 1px solid #eaeaea;
      border-radius: var(--radius);
      padding: 12px;
      height: 420px;
      overflow-y: auto;
      background: #fafafa;
    }

    .msg {
      margin: 10px 0;
      line-height: 1.4;
    }

    .msg .bubble {
      display: inline-block;
      padding: 10px 12px;
      border-radius: 14px;
    }

    .user .bubble {
      background: #e9f2ff;
    }

    .bot .bubble {
      background: #ecfff0;
    }

    .row {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    input[type="text"] {
      flex: 1;
      padding: 12px 14px;
      border: 1px solid #ddd;
      border-radius: 12px;
      font-size: 16px;
    }

    button {
      padding: 12px 14px;
      border: none;
      border-radius: 12px;
      background: #3b82f6;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
    }

    button.secondary {
      background: #10b981;
    }

    #suggestions {
      margin-top: 10px;
    }

    #suggestions button {
      margin: 4px;
      padding: 6px 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #0000FF;
      cursor: pointer;
      font-size: 14px;
    }

    #suggestions button:hover {
      background: #dbeafe;
    }

    .small {
      font-size: 12px;
      color: #666;
      margin-top: 8px;
    }
  </style>

  <!-- Matomo -->
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function () {
      var u = "https://luuluux10network.matomo.cloud/";
      _paq.push(['setTrackerUrl', u + 'matomo.php']);
      _paq.push(['setSiteId', '1']);
      var d = document, g = d.createElement('script'), s = d.getElementsByTagName('script')[0];
      g.async = true; g.src = 'https://cdn.matomo.cloud/luuluux10network.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g, s);
    })();
  </script>
  <!-- End Matomo Code -->

</head>

<body>
  <div class="container">
    <h1>ü§ñ Chatbot v·ªÅ v·∫•n ƒë·ªÅ ph·∫ßn m·ªÅm thi PMT-EMS ExamSys</h1>
    <p class="meta">t·∫£i ph·∫ßn m·ªÅm t·∫°i link n√†y: <a
        href="https://drive.google.com/file/d/15OpUEeBoOhfDhatggDUFE4EcQ-gbjJhu/view" target="_blank"><u>Google
          Drive</u></a></p>
    <div id="chatbox"></div>
    <div id="suggestions"></div>

    <div class="row">
      <input id="message" type="text" placeholder="Nh·∫≠p c√¢u h·ªèi v√† nh·∫•n Enter..." autofocus />
      <button id="sendBtn">G·ª≠i</button>
      <button class="secondary" id="reloadBtn" title="ƒê·ªçc l·∫°i file d·ªØ li·ªáu">T·∫£i l·∫°i</button>
    </div>
    <div class="small">M·∫πo: s·ª≠a/ghi th√™m d·ªØ li·ªáu trong file <code>content.csv</code> ho·∫∑c <code>content.xlsx</code>, r·ªìi
      b·∫•m ‚ÄúT·∫£i l·∫°i‚Äù.</div>
  </div>

  <script>
    const chatbox = document.getElementById('chatbox');
    const input = document.getElementById('message');
    const sendBtn = document = document.getElementById('sendBtn');
    const reloadBtn = document.getElementById('reloadBtn');
    const suggBox = document.getElementById('suggestions');

    function append(type, text) {
      const el = document.createElement('div');
      el.className = 'msg ' + type;
      //el.innerHTML = '<div class="bubble">' + text.replace(/</g,'&lt;') + '</div>';
      el.innerHTML = '<div class="bubble">' + text.replace(/\n/g, "<br>") + '</div>';
      chatbox.appendChild(el);
      chatbox.scrollTop = chatbox.scrollHeight;
    }
    function sendSuggestion(txt) { input.value = txt; sendMessage(); }

    async function sendMessage() {
      const msg = input.value.trim();
      if (!msg) return;
      append('user', 'B·∫°n: ' + msg);
      input.value = '';
      sendBtn.disabled = true;
      try {
        const res = await fetch('/ask', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ message: msg }) });
        const data = await res.json();
        append('bot', 'Bot: ' + (data.reply || 'C√≥ l·ªói x·∫£y ra.'));
        // suggestions
        suggBox.innerHTML = '';
        if (data.suggestions && data.suggestions.length) {
          const p = document.createElement('p'); p.textContent = 'üëâ B·∫°n c√≥ th·ªÉ h·ªèi th√™m:'; suggBox.appendChild(p);
          data.suggestions.forEach(q => {
            const b = document.createElement('button'); b.textContent = q; b.onclick = () => sendSuggestion(q); suggBox.appendChild(b);
          });
        }
      } catch (e) {
        append('bot', 'Bot: L·ªói m·∫°ng. Vui l√≤ng th·ª≠ l·∫°i.');
      } finally {
        sendBtn.disabled = false; input.focus();
      }
    }

    async function reloadData() {
      reloadBtn.disabled = true;
      try { const res = await fetch('/reload', { method: 'POST' }); const data = await res.json(); append('bot', 'ƒê√£ t·∫£i l·∫°i d·ªØ li·ªáu (' + (data.count ?? 0) + ' m·ª•c).'); }
      catch (e) { append('bot', 'Kh√¥ng t·∫£i l·∫°i ƒë∆∞·ª£c d·ªØ li·ªáu.'); }
      finally { reloadBtn.disabled = false; }
    }

    sendBtn.addEventListener('click', sendMessage);
    input.addEventListener('keydown', e => { if (e.key === 'Enter') sendMessage(); });
    reloadBtn.addEventListener('click', reloadData);

    // L·ªùi ch√†o
    append('bot', 'Ch√†o b·∫°n üëã! H√£y h·ªèi m√¨nh v·ªÅ v·∫•n ƒë·ªÅ ph·∫ßn m·ªÅm thi nh√©. T·∫£i ph·∫ßn m·ªÅm thi t·∫°i <a href="https://drive.google.com/file/d/15OpUEeBoOhfDhatggDUFE4EcQ-gbjJhu/view" target="_blank">ƒë√¢y</a>');
  </script>
</body>

</html>